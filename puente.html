<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misi√≥n: Puy du Fou - S√°bado 6 de Diciembre</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap" rel="stylesheet">
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #F0F3F4; /* Light Gray/Blue background */
            color: #2C3E50; /* Dark Slate Blue text */
        }
        
        /* Custom Palette - "Royal & Vibrant" */
        .text-primary { color: #2980B9; } /* Blue */
        .bg-primary { background-color: #2980B9; }
        .text-secondary { color: #E67E22; } /* Orange */
        .bg-secondary { background-color: #E67E22; }
        .text-accent { color: #C0392B; } /* Red */
        .bg-accent { background-color: #C0392B; }
        .text-success { color: #27AE60; } /* Green */
        .bg-success { background-color: #27AE60; }

        /* Chart Container Styling - MANDATORY */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Timeline Styling */
        .timeline-line {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 100%;
            background-color: #BDC3C7;
            z-index: 0;
        }
        .timeline-item {
            position: relative;
            z-index: 10;
        }

        /* AI Oracle Styling */
        .oracle-box {
            background: linear-gradient(135deg, #2980B9 0%, #6DD5FA 100%);
        }
        .chat-bubble {
            position: relative;
            background: white;
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .chat-bubble::after {
            content: '';
            position: absolute;
            left: 20px;
            bottom: -10px;
            border-width: 10px 10px 0;
            border-style: solid;
            border-color: white transparent;
            display: block;
            width: 0;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #E67E22;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="pb-12">

    <!-- Header Section -->
    <header class="bg-primary text-white py-12 px-4 shadow-lg mb-8">
        <div class="max-w-5xl mx-auto text-center">
            <h1 class="text-4xl md:text-6xl font-black mb-4 uppercase tracking-wider">Misi√≥n: Puy du Fou</h1>
            <p class="text-xl md:text-2xl font-light">Estrategia Operativa para el S√°bado 6 de Diciembre, 2025</p>
            <div class="mt-6 flex justify-center gap-4 flex-wrap">
                <span class="bg-white text-primary px-4 py-2 rounded-full font-bold shadow-md">üìç Toledo, ES</span>
                <span class="bg-secondary text-white px-4 py-2 rounded-full font-bold shadow-md">üìÖ 06/12/2025</span>
                <span class="bg-accent text-white px-4 py-2 rounded-full font-bold shadow-md">üåßÔ∏è Alerta Lluvia</span>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 grid grid-cols-1 md:grid-cols-2 gap-8">

        <!-- Section 1: Introduction -->
        <div class="col-span-1 md:col-span-2 bg-white rounded-lg shadow-md p-8">
            <h2 class="text-3xl font-bold text-primary mb-4 border-b-2 border-secondary pb-2">Informe de Situaci√≥n</h2>
            <p class="text-lg text-gray-700 leading-relaxed">
                Agentes viajeros, su misi√≥n para el <strong>Puente de la Inmaculada</strong> es clara: conquistar Puy du Fou en un solo d√≠a. 
                Nos enfrentamos a un s√°bado de m√°xima afluencia y meteorolog√≠a inestable. 
                Esta hoja de ruta visualiza los datos cr√≠ticos de supervivencia: desde la probabilidad de lluvia hasta la cronolog√≠a exacta para evitar las colas.
                <br><br>
                <strong>Objetivo Principal:</strong> Completar **todos los grandes espect√°culos** (5 en total) antes del cierre a las 19:00h, minimizando la exposici√≥n a la lluvia y maximizando el tiempo en interiores.
            </p>
        </div>

        <!-- NEW AI SECTION: The Traveler's Oracle -->
        <div class="col-span-1 md:col-span-2 oracle-box rounded-lg shadow-xl p-8 text-white">
            <div class="flex flex-col md:flex-row items-start gap-6">
                <div class="flex-1">
                    <h2 class="text-3xl font-bold mb-2">‚ú® El Or√°culo del Viajero</h2>
                    <p class="mb-4 text-blue-100">
                        ¬øTienes dudas sobre el plan? Nuestra IA experta en Puy du Fou tiene acceso a los datos meteorol√≥gicos y al mapa del parque. Preg√∫ntale lo que quieras.
                    </p>
                    
                    <!-- Predefined Prompt Buttons -->
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button onclick="askOracle('¬øQu√© ropa exacta me recomiendas para la lluvia y el fr√≠o de hoy?')" class="bg-white text-primary px-4 py-2 rounded-full font-bold text-sm hover:bg-gray-100 transition shadow-sm">
                            ‚ú® ¬øQu√© me pongo?
                        </button>
                        <button onclick="askOracle('Tengo ni√±os peque√±os, ¬øqu√© espect√°culos priorizo si se cansan?')" class="bg-white text-primary px-4 py-2 rounded-full font-bold text-sm hover:bg-gray-100 transition shadow-sm">
                            ‚ú® Plan con ni√±os
                        </button>
                        <button onclick="askOracle('¬øD√≥nde puedo comer caliente y r√°pido?')" class="bg-white text-primary px-4 py-2 rounded-full font-bold text-sm hover:bg-gray-100 transition shadow-sm">
                            ‚ú® Comida caliente
                        </button>
                    </div>

                    <!-- Input Area -->
                    <div class="relative">
                        <input type="text" id="oracleInput" placeholder="Escribe tu pregunta aqu√≠..." class="w-full p-4 pr-12 rounded-lg text-gray-800 shadow-inner focus:outline-none focus:ring-4 focus:ring-secondary">
                        <button onclick="askOracle()" class="absolute right-2 top-2 bg-secondary text-white p-2 rounded-lg hover:bg-orange-600 transition">
                            ‚û§
                        </button>
                    </div>
                </div>

                <!-- Response Area -->
                <div class="flex-1 w-full md:w-auto">
                    <div id="oracleResponse" class="chat-bubble text-gray-800 min-h-[150px] hidden">
                        <!-- Content will be injected here -->
                    </div>
                    <div id="oracleLoading" class="hidden text-center py-8">
                        <div class="loader"></div>
                        <p class="mt-2 text-blue-100 font-bold">Consultando los pergaminos...</p>
                    </div>
                    <!-- Intro Bubble -->
                    <div id="oracleIntro" class="chat-bubble text-gray-800">
                        <p class="font-bold text-primary">üëã ¬°Saludos, viajero!</p>
                        <p class="text-sm mt-1">Soy el guardi√°n digital. Conozco el clima (15¬∞C m√°x, lluvia) y los horarios. Preg√∫ntame c√≥mo sobrevivir a tu visita.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: Weather Intelligence -->
        <div class="col-span-1 bg-white rounded-lg shadow-md p-6 border-l-8 border-accent">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">‚õàÔ∏è Inteligencia Meteorol√≥gica</h3>
            <p class="text-gray-600 mb-6">
                El tiempo ser√° el factor cr√≠tico. Se esperan temperaturas frescas y una probabilidad significativa de lluvia ligera acompa√±ada de viento. 
                El siguiente gr√°fico muestra el rango t√©rmico y el riesgo de precipitaci√≥n.
            </p>
            
            <div class="chart-container">
                <canvas id="weatherChart"></canvas>
            </div>
            
            <div class="mt-4 text-center">
                <p class="text-sm font-bold text-accent">¬°Sensaci√≥n t√©rmica reducida por viento!</p>
            </div>
        </div>

        <!-- Section 3: Risk Analysis (Rain Probability) -->
        <div class="col-span-1 bg-white rounded-lg shadow-md p-6 border-l-8 border-primary">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">‚òî Probabilidad de Lluvia</h3>
            <p class="text-gray-600 mb-6">
                No dej√©is nada al azar. Con un riesgo del 30%, el poncho es obligatorio. 
                Este gr√°fico desglosa la probabilidad de encontrarnos agua durante la operaci√≥n.
            </p>

            <div class="chart-container">
                <canvas id="rainChart"></canvas>
            </div>
        </div>

        <!-- Section 4: Gear Loadout (HTML/CSS Visualization) -->
        <div class="col-span-1 md:col-span-2 bg-white rounded-lg shadow-md p-8">
            <h3 class="text-2xl font-bold text-gray-800 mb-6 border-b border-gray-200 pb-2">üéí Equipamiento T√°ctico (Checklist)</h3>
            <p class="text-gray-600 mb-6">
                Para garantizar el √©xito de la misi√≥n bajo condiciones de lluvia y caminata intensiva, cada miembro del equipo debe portar los siguientes √≠tems.
            </p>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- Item 1 -->
                <div class="bg-blue-50 p-4 rounded-xl text-center hover:shadow-lg transition-shadow border-2 border-primary">
                    <div class="text-4xl mb-2">üß•</div>
                    <h4 class="font-bold text-primary">Poncho/Chubasquero</h4>
                    <p class="text-xs text-gray-500 mt-1">OBLIGATORIO. Mejor que paraguas.</p>
                </div>
                <!-- Item 2 -->
                <div class="bg-orange-50 p-4 rounded-xl text-center hover:shadow-lg transition-shadow border-2 border-secondary">
                    <div class="text-4xl mb-2">üßÖ</div>
                    <h4 class="font-bold text-secondary">Sistema de Capas</h4>
                    <p class="text-xs text-gray-500 mt-1">T√©rmica + Jersey + Abrigo.</p>
                </div>
                <!-- Item 3 -->
                <div class="bg-gray-50 p-4 rounded-xl text-center hover:shadow-lg transition-shadow border-2 border-gray-400">
                    <div class="text-4xl mb-2">ü•æ</div>
                    <h4 class="font-bold text-gray-700">Calzado Water-Resist</h4>
                    <p class="text-xs text-gray-500 mt-1">Caminos de tierra = Barro.</p>
                </div>
                <!-- Item 4 -->
                <div class="bg-red-50 p-4 rounded-xl text-center hover:shadow-lg transition-shadow border-2 border-accent">
                    <div class="text-4xl mb-2">üéí</div>
                    <h4 class="font-bold text-accent">Mochila Impermeable</h4>
                    <p class="text-xs text-gray-500 mt-1">Protege ropa seca y m√≥viles.</p>
                </div>
            </div>
        </div>

        <!-- Section 5: Tactical Timeline (UPDATED) -->
        <div class="col-span-1 md:col-span-2 lg:col-span-1 bg-white rounded-lg shadow-md p-6">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">‚è±Ô∏è Cronograma de Operaciones (Completo)</h3>
            <p class="text-gray-600 mb-6">
                ¬°Misi√≥n completa! Este flujo horario est√° dise√±ado para ver los **5 grandes espect√°culos** y aprovechar las experiencias de los pueblos. ¬°M√°xima puntualidad requerida!
            </p>

            <div class="relative py-4">
                <!-- Vertical Line -->
                <div class="timeline-line"></div>

                <!-- Event 1 (Log√≠stica) -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-20 text-right font-bold text-primary mr-4">09:00</div>
                    <div class="w-4 h-4 bg-primary rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-blue-50 p-3 rounded-lg shadow-sm border-l-4 border-primary">
                        <h4 class="font-bold">Llegada y Posicionamiento</h4>
                        <p class="text-sm">Parqueo y fila en tornos. El tiempo es oro.</p>
                    </div>
                </div>

                <!-- Event 2 (Log√≠stica) -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-20 text-right font-bold text-secondary mr-4">09:30</div>
                    <div class="w-4 h-4 bg-secondary rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-orange-50 p-3 rounded-lg shadow-sm border-l-4 border-secondary">
                        <h4 class="font-bold">Acceso al Parque</h4>
                        <p class="text-sm">Entrada y marcha r√°pida hacia la zona baja (Villas de Anta√±o).</p>
                    </div>
                </div>
                
                <!-- Event 3 (Show 1 - Interior) -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-20 text-right font-bold text-accent mr-4">10:00</div>
                    <div class="w-4 h-4 bg-accent rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-red-50 p-3 rounded-lg shadow-sm border-l-4 border-accent">
                        <h4 class="font-bold text-accent">üî• El √öltimo Cantar (Indoor)</h4>
                        <p class="text-sm">Primer golpe en un espect√°culo a cubierto.</p>
                    </div>
                </div>

                <!-- Event 4 (Pueblo/Experiencia Menor) -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-20 text-right font-bold text-success mr-4">11:15</div>
                    <div class="w-4 h-4 bg-success rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-green-50 p-3 rounded-lg shadow-sm border-l-4 border-success">
                        <h4 class="font-bold text-success">Exploraci√≥n de Villas</h4>
                        <p class="text-sm">Visita al Askar Andalus√≠ o La Venta de Isidro.</p>
                    </div>
                </div>

                <!-- Event 5 (Show 2 - Interior) -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-20 text-right font-bold text-accent mr-4">12:00</div>
                    <div class="w-4 h-4 bg-accent rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-red-50 p-3 rounded-lg shadow-sm border-l-4 border-accent">
                        <h4 class="font-bold text-accent">üó°Ô∏è A Pluma y Espada (Indoor)</h4>
                        <p class="text-sm">Estrategia de ma√±ana cubierta (2/5).</p>
                    </div>
                </div>

                <!-- Event 6 (Comida Estrat√©gica) -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-20 text-right font-bold text-secondary mr-4">13:30</div>
                    <div class="w-4 h-4 bg-secondary rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-orange-50 p-3 rounded-lg shadow-sm border-l-4 border-secondary">
                        <h4 class="font-bold text-secondary">Avituallamiento (Early Lunch)</h4>
                        <p class="text-sm">Comida temprana para evitar colas cr√≠ticas de las 14:30.</p>
                    </div>
                </div>

                <!-- Event 7 (Show 3 - Interior) -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-20 text-right font-bold text-accent mr-4">14:30</div>
                    <div class="w-4 h-4 bg-accent rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-red-50 p-3 rounded-lg shadow-sm border-l-4 border-accent">
                        <h4 class="font-bold text-accent">üåä Allende la Mar Oc√©ana (Indoor)</h4>
                        <p class="text-sm">Tercer gran espect√°culo bajo techo.</p>
                    </div>
                </div>
                
                <!-- Event 8 (Show 4 - Exterior, el m√°s cr√≠tico) -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-20 text-right font-bold text-accent mr-4">16:00</div>
                    <div class="w-4 h-4 bg-accent rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-red-50 p-3 rounded-lg shadow-sm border-l-4 border-accent">
                        <h4 class="font-bold text-accent">ü¶Ö Cetrer√≠a de Reyes (Outdoor)</h4>
                        <p class="text-sm">El √∫nico show grande al aire libre. Usar el chubasquero.</p>
                    </div>
                </div>

                <!-- Event 9 (Show 5 - Interior) -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-20 text-right font-bold text-accent mr-4">17:30</div>
                    <div class="w-4 h-4 bg-accent rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-red-50 p-3 rounded-lg shadow-sm border-l-4 border-accent">
                        <h4 class="font-bold text-accent">üê¥ Sorbaces (Indoor)</h4>
                        <p class="text-sm">El √∫ltimo espect√°culo principal (5/5) antes del cierre.</p>
                    </div>
                </div>

                <!-- Event 10 (Log√≠stica) -->
                <div class="timeline-item flex items-center">
                    <div class="w-20 text-right font-bold text-primary mr-4">19:00</div>
                    <div class="w-4 h-4 bg-primary rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-blue-50 p-3 rounded-lg shadow-sm border-l-4 border-primary">
                        <h4 class="font-bold">Retirada T√°ctica</h4>
                        <p class="text-sm">Salida planificada antes del colapso de la noche.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 6: Show Strategy (Pie Chart) -->
        <div class="col-span-1 md:col-span-2 lg:col-span-1 bg-white rounded-lg shadow-md p-6">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">üõ°Ô∏è An√°lisis de Cobertura</h3>
            <p class="text-gray-600 mb-6">
                Dado el riesgo de lluvia, es vital conocer qu√© porcentaje del plan est√° a cubierto.
                La mayor√≠a de los "Grandes" son Indoor, lo que juega a nuestro favor.
                <strong>Cetrer√≠a de Reyes</strong> es el √∫nico punto cr√≠tico al aire libre.
            </p>

            <div class="chart-container">
                <canvas id="showsChart"></canvas>
            </div>
            <ul class="mt-6 space-y-2 text-sm text-gray-600">
                <li class="flex items-center"><span class="w-3 h-3 bg-primary rounded-full mr-2"></span> <strong>Indoor:</strong> A Pluma y Espada, El √öltimo Cantar, Allende la Mar, Sorbaces.</li>
                <li class="flex items-center"><span class="w-3 h-3 bg-secondary rounded-full mr-2"></span> <strong>Outdoor:</strong> Cetrer√≠a de Reyes (¬°Priorizar si sale el sol!).</li>
            </ul>
        </div>

        <!-- Footer -->
        <div class="col-span-1 md:col-span-2 text-center py-8 text-gray-500 text-sm">
            <p>Generado para la Misi√≥n Puy du Fou 2025. Datos basados en previsi√≥n meteorol√≥gica del 06/12/2025.</p>
        </div>

    </main>

    <script>
        // --- GEMINI API INTEGRATION ---
        
        async function askOracle(presetQuestion = null) {
            const apiKey = ""; // Runtime Environment Key
            const inputField = document.getElementById('oracleInput');
            const introDiv = document.getElementById('oracleIntro');
            const responseDiv = document.getElementById('oracleResponse');
            const loadingDiv = document.getElementById('oracleLoading');
            
            const userQuestion = presetQuestion || inputField.value;

            if (!userQuestion) return;

            // UI State Updates
            introDiv.classList.add('hidden');
            responseDiv.classList.add('hidden');
            loadingDiv.classList.remove('hidden');
            if (presetQuestion) inputField.value = presetQuestion;

            // Context Prompt
            const systemContext = `
                Eres el "Or√°culo del Viajero", un experto gu√≠a medieval del parque Puy du Fou Espa√±a en Toledo.
                Datos Actuales:
                - Fecha: S√°bado 6 de Diciembre de 2025.
                - Clima: M√°x 15¬∞C, M√≠n 9¬∞C. Lluvia ligera y viento moderado.
                - Multitud: D√≠a de m√°xima afluencia (Puente).
                - Espect√°culos Clave: El √öltimo Cantar, A Pluma y Espada, Allende la Mar Oc√©ana, Cetrer√≠a de Reyes, Sorbaces.
                - Horario de Operaci√≥n: 9:00h a 19:00h seg√∫n el plan t√°ctico.
                
                Tu Misi√≥n:
                - Responde a la pregunta del usuario de forma breve, √∫til y con un ligero toque √©pico/medieval.
                - Usa emojis ‚ú®.
                - Si preguntan por ropa, insiste en capas y chubasquero.
                - Si preguntan por comida, sugiere horarios fuera de hora punta (antes de 13:30).
            `;

            try {
                // Exponential backoff logic for retries
                let response;
                let data;
                const maxRetries = 3;
                let delay = 1000; // 1 second

                for (let i = 0; i < maxRetries; i++) {
                    response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: systemContext + "\n\nPregunta del viajero: " + userQuestion
                                }]
                            }]
                        })
                    });

                    data = await response.json();

                    if (!data.error) {
                        break; // Success
                    }

                    if (i < maxRetries - 1) {
                        // Wait before retrying
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // Exponential backoff
                    } else {
                        throw new Error(data.error.message || 'Error desconocido al consultar el Or√°culo.');
                    }
                }
                
                if (data.error) {
                    throw new Error(data.error.message || 'Error desconocido al consultar el Or√°culo.');
                }

                const answer = data.candidates[0].content.parts[0].text;
                
                // Render Response with Markdown parsing
                responseDiv.innerHTML = marked.parse(answer);
                loadingDiv.classList.add('hidden');
                responseDiv.classList.remove('hidden');

            } catch (error) {
                console.error('Error:', error);
                loadingDiv.classList.add('hidden');
                responseDiv.innerHTML = `<p class="text-red-600 font-bold">‚ò†Ô∏è El or√°culo est√° nublado. Int√©ntalo de nuevo m√°s tarde.</p>`;
                responseDiv.classList.remove('hidden');
            }
        }


        // --- CHART DATA PROCESSING & CONFIGURATION (Existing Code) ---

        // Label Wrapping Helper Function (Mandatory)
        function formatLabel(str, maxwidth) {
            var sections = [];
            var words = str.split(" ");
            var temp = "";

            words.forEach(function(item, index) {
                if (temp.length > 0) {
                    var concat = temp + ' ' + item;
                    if (concat.length > maxwidth) {
                        sections.push(temp);
                        temp = "";
                    } else {
                        if (index == (words.length - 1)) {
                            sections.push(concat);
                            return;
                        } else {
                            temp = concat;
                            return;
                        }
                    }
                }
                if (index == (words.length - 1)) {
                    sections.push(item);
                    return;
                }
                if (item.length < maxwidth) {
                    temp = item;
                } else {
                    sections.push(item);
                }
            });
            return sections;
        }

        // Common Chart Options
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        font: { family: 'Roboto', size: 12 },
                        color: '#2C3E50',
                        usePointStyle: true,
                        padding: 20
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(44, 62, 80, 0.9)',
                    titleFont: { family: 'Roboto', size: 14, weight: 'bold' },
                    bodyFont: { family: 'Roboto', size: 13 },
                    padding: 10,
                    cornerRadius: 8,
                    callbacks: {
                        // MANDATORY TOOLTIP CONFIGURATION
                        title: function(tooltipItems) {
                            const item = tooltipItems[0];
                            let label = item.chart.data.labels[item.dataIndex];
                            if (Array.isArray(label)) {
                                return label.join(' ');
                            } else {
                                return label;
                            }
                        }
                    }
                }
            }
        };

        // --- CHART 1: WEATHER (Bar Chart for Range) ---
        const ctxWeather = document.getElementById('weatherChart').getContext('2d');
        const weatherChart = new Chart(ctxWeather, {
            type: 'bar',
            data: {
                labels: formatLabel('Temperatura M√≠nima, Temperatura M√°xima', 15),
                datasets: [{
                    label: 'Grados Celsius (¬∞C)',
                    data: [9, 15],
                    backgroundColor: [
                        'rgba(41, 128, 185, 0.7)', // Blue for Cold
                        'rgba(230, 126, 34, 0.7)'  // Orange for High
                    ],
                    borderColor: [
                        '#2980B9',
                        '#E67E22'
                    ],
                    borderWidth: 1,
                    borderRadius: 8,
                    barPercentage: 0.6
                }]
            },
            options: {
                ...commonOptions,
                plugins: {
                    ...commonOptions.plugins,
                    legend: { display: false }, // Hide legend for simple bar
                    title: {
                        display: true,
                        text: 'Rango de Temperaturas (S√°bado 6)',
                        font: { family: 'Roboto', size: 16 }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 20,
                        title: { display: true, text: 'Temperatura (¬∞C)' }
                    }
                }
            }
        });

        // --- CHART 2: RAIN PROBABILITY (Doughnut) ---
        const ctxRain = document.getElementById('rainChart').getContext('2d');
        const rainChart = new Chart(ctxRain, {
            type: 'doughnut',
            data: {
                labels: formatLabel('Probabilidad de Lluvia, Tiempo Seco', 15),
                datasets: [{
                    data: [30, 70],
                    backgroundColor: [
                        '#2980B9', // Rain Blue
                        '#ECF0F1'  // Dry Gray
                    ],
                    borderColor: '#ffffff',
                    borderWidth: 2,
                    hoverOffset: 4
                }]
            },
            options: {
                ...commonOptions,
                cutout: '70%',
                plugins: {
                    ...commonOptions.plugins,
                    title: {
                        display: true,
                        text: 'Riesgo de Precipitaci√≥n',
                        font: { family: 'Roboto', size: 16 }
                    }
                }
            },
            plugins: [{
                id: 'textCenter',
                beforeDraw: function(chart) {
                    var width = chart.width,
                        height = chart.height,
                        ctx = chart.ctx;
                    ctx.restore();
                    var fontSize = (height / 114).toFixed(2);
                    ctx.font = "bold " + fontSize + "em Roboto";
                    ctx.textBaseline = "middle";
                    ctx.fillStyle = "#2980B9";
                    var text = "30%",
                        textX = Math.round((width - ctx.measureText(text).width) / 2),
                        textY = height / 2;
                    ctx.fillText(text, textX, textY);
                    ctx.save();
                }
            }]
        });

        // --- CHART 3: SHOW DISTRIBUTION (Pie Chart) ---
        // Data: 4 Indoor Shows vs 1 Outdoor Show
        const ctxShows = document.getElementById('showsChart').getContext('2d');
        const showsChart = new Chart(ctxShows, {
            type: 'pie',
            data: {
                labels: formatLabel('Espect√°culos a Cubierto (Indoor), Espect√°culos al Aire Libre (Outdoor)', 15),
                datasets: [{
                    data: [4, 1], // 4 Indoor, 1 Outdoor
                    backgroundColor: [
                        '#27AE60', // Green for Safe/Indoor
                        '#E67E22'  // Orange for Caution/Outdoor
                    ],
                    borderColor: '#ffffff',
                    borderWidth: 2
                }]
            },
            options: {
                ...commonOptions,
                plugins: {
                    ...commonOptions.plugins,
                    title: {
                        display: true,
                        text: 'Distribuci√≥n de Espect√°culos',
                        font: { family: 'Roboto', size: 16 }
                    }
                }
            }
        });

    </script>
</body>
</html>
