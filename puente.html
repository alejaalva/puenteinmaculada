<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misi√≥n: Puy du Fou - Navidad 2025</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&family=Cinzel:wght@700&display=swap" rel="stylesheet">
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #Fdfbf7; /* Warm parchment background for Christmas */
            color: #2C3E50;
        }
        
        h1, h2, h3, h4 {
            font-family: 'Cinzel', serif; /* Medieval/Christmas font */
        }

        /* Christmas Palette */
        .text-primary { color: #165B33; } /* Christmas Green */
        .bg-primary { background-color: #165B33; }
        .text-secondary { color: #BB2528; } /* Christmas Red */
        .bg-secondary { background-color: #BB2528; }
        .text-accent { color: #D4AF37; } /* Gold */
        .bg-accent { background-color: #D4AF37; }
        .text-snow { color: #1B4F72; } /* Winter Blue */
        
        /* Header Background with AI Image */
        .header-bg {
            background-image: linear-gradient(rgba(22, 91, 51, 0.7), rgba(187, 37, 40, 0.6)), url('https://alejaalva.github.io/puenteinmaculada/cabecera.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* Chart Container Styling */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Timeline Styling */
        .timeline-line {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 100%;
            background-color: #D4AF37; /* Gold Line */
            z-index: 0;
        }
        .timeline-item {
            position: relative;
            z-index: 10;
        }

        /* AI Oracle Styling */
        .oracle-box {
            background: linear-gradient(135deg, #165B33 0%, #0F3B21 100%);
            border: 2px solid #D4AF37;
        }
        .chat-bubble {
            position: relative;
            background: white;
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #BB2528;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="pb-12">

    <!-- Header Section -->
    <header class="header-bg text-white py-20 px-4 shadow-lg mb-8 transition-all duration-500 hover:shadow-2xl border-b-8 border-accent">
        <div class="max-w-5xl mx-auto text-center">
            <h1 class="text-4xl md:text-7xl font-black mb-4 uppercase tracking-wider drop-shadow-lg text-accent">Navidad en Puy du Fou</h1>
            <p class="text-xl md:text-3xl font-light drop-shadow-md text-white">Estrategia T√°ctica: S√°bado 6 de Diciembre</p>
            <div class="mt-8 flex justify-center gap-4 flex-wrap">
                <span class="bg-white/90 text-primary px-6 py-2 rounded-full font-bold shadow-md backdrop-blur-sm">üéÑ Edici√≥n Especial</span>
                <span class="bg-secondary/90 text-white px-6 py-2 rounded-full font-bold shadow-md backdrop-blur-sm">üìÖ 06/12/2025</span>
                <span class="bg-accent/90 text-white px-6 py-2 rounded-full font-bold shadow-md backdrop-blur-sm">‚è∞ Apertura 10:00h</span>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 grid grid-cols-1 md:grid-cols-2 gap-8">

        <!-- Section 1: Introduction -->
        <div class="col-span-1 md:col-span-2 bg-white rounded-lg shadow-md p-8 border-t-4 border-secondary">
            <h2 class="text-3xl font-bold text-secondary mb-4 border-b-2 border-accent pb-2">Informe de Navidad (Actualizado)</h2>
            <p class="text-lg text-gray-700 leading-relaxed">
                Agentes, confirmado: el parque abre sus puertas a las <strong>10:00h</strong>. Esta ventaja t√°ctica es crucial para adelantarnos a la multitud.
                <br><br>
                <strong>‚ö†Ô∏è Cambios Cr√≠ticos:</strong>
                <ul class="list-disc list-inside mt-2 ml-4">
                    <li><strong>Horario:</strong> Apertura a las <strong>10:00h</strong>. Llegad al parking a las 09:30h.</li>
                    <li><strong>Cancelados:</strong> <em>Cetrer√≠a de Reyes</em> (aves) y <em>El Sue√±o de Toledo</em> no se realizan en invierno.</li>
                    <li><strong>Novedades:</strong> Prioridad al show navide√±o <em>"Sue√±os de un √Ångel P√≠caro"</em> y al <em>Gran Bel√©n Viviente"</em>.</li>
                </ul>
            </p>
        </div>

        <!-- NEW AI SECTION: The Traveler's Oracle -->
        <div class="col-span-1 md:col-span-2 oracle-box rounded-lg shadow-xl p-8 text-white">
            <div class="flex flex-col md:flex-row items-start gap-6">
                <div class="flex-1">
                    <h2 class="text-3xl font-bold mb-2 text-accent">‚ú® El Or√°culo Navide√±o</h2>
                    <p class="mb-4 text-green-100">
                        Preg√∫ntame sobre los especiales de Navidad, d√≥nde encontrar chocolate caliente o el horario del Bel√©n.
                    </p>
                    
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button onclick="askOracle('¬øQu√© tiene de especial la Navidad en el parque?')" class="bg-white text-primary px-4 py-2 rounded-full font-bold text-sm hover:bg-gray-100 transition shadow-sm">
                            üéÑ Especiales Navidad
                        </button>
                        <button onclick="askOracle('¬øHace mucho fr√≠o en los teatros interiores?')" class="bg-white text-primary px-4 py-2 rounded-full font-bold text-sm hover:bg-gray-100 transition shadow-sm">
                            ‚ùÑÔ∏è Fr√≠o en Teatros
                        </button>
                    </div>

                    <div class="relative">
                        <input type="text" id="oracleInput" placeholder="Escribe tu pregunta aqu√≠..." class="w-full p-4 pr-12 rounded-lg text-gray-800 shadow-inner focus:outline-none focus:ring-4 focus:ring-accent">
                        <button onclick="askOracle()" class="absolute right-2 top-2 bg-accent text-white p-2 rounded-lg hover:bg-yellow-600 transition">‚û§</button>
                    </div>
                </div>

                <div class="flex-1 w-full md:w-auto">
                    <div id="oracleResponse" class="chat-bubble text-gray-800 min-h-[150px] hidden"></div>
                    <div id="oracleLoading" class="hidden text-center py-8">
                        <div class="loader"></div>
                        <p class="mt-2 text-green-100 font-bold">Consultando a los Reyes Magos...</p>
                    </div>
                    <div id="oracleIntro" class="chat-bubble text-gray-800">
                        <p class="font-bold text-primary">üëë ¬°Felices Fiestas!</p>
                        <p class="text-sm mt-1">Soy tu gu√≠a de Navidad. ¬°Apertura confirmada a las 10:00h! Aprovecha la ma√±ana.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: Weather & Gear (Condensed) -->
        <div class="col-span-1 bg-white rounded-lg shadow-md p-6 border-l-8 border-snow">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">‚õàÔ∏è Clima de Diciembre</h3>
            <div class="chart-container h-64">
                <canvas id="weatherChart"></canvas>
            </div>
            <p class="text-sm text-center mt-2 text-gray-500">M√°x 15¬∞C / M√≠n 9¬∞C - Lluvia probable.</p>
        </div>

        <div class="col-span-1 bg-white rounded-lg shadow-md p-6 border-l-8 border-secondary">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">üéí Kit de Supervivencia</h3>
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-red-50 p-3 rounded text-center border border-secondary">
                    <span class="text-2xl">üß•</span><br><strong>Abrigo + Capas</strong>
                </div>
                <div class="bg-blue-50 p-3 rounded text-center border border-snow">
                    <span class="text-2xl">‚òî</span><br><strong>Poncho Lluvia</strong>
                </div>
                <div class="bg-yellow-50 p-3 rounded text-center border border-accent">
                    <span class="text-2xl">üß§</span><br><strong>Guantes/Gorro</strong>
                </div>
                <div class="bg-green-50 p-3 rounded text-center border border-primary">
                    <span class="text-2xl">üç´</span><br><strong>Snacks</strong>
                </div>
            </div>
        </div>

        <!-- Section 3: Christmas Timeline (UPDATED 10:00 START) -->
        <div class="col-span-1 md:col-span-2 bg-white rounded-lg shadow-md p-6">
            <h3 class="text-2xl font-bold text-secondary mb-6 text-center">‚è±Ô∏è Cronograma Navide√±o (10:00h - 19:00h)</h3>
            <p class="text-center text-gray-600 mb-8 max-w-2xl mx-auto">
                Estrategia optimizada para la apertura temprana. Aprovechad la primera hora para ver el show m√°s popular sin colas.
            </p>

            <div class="relative py-4 max-w-3xl mx-auto">
                <div class="timeline-line"></div>

                <!-- 10:00 Opening -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-24 text-right font-bold text-primary mr-4">10:00</div>
                    <div class="w-4 h-4 bg-primary rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-green-50 p-4 rounded-lg shadow-sm border-l-4 border-primary">
                        <h4 class="font-bold">Apertura de Puertas</h4>
                        <p class="text-sm">¬°Entrada triunfal! Directos a la zona baja.</p>
                    </div>
                </div>

                <!-- 10:45 Show 1 -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-24 text-right font-bold text-secondary mr-4">10:45</div>
                    <div class="w-4 h-4 bg-secondary rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-red-50 p-4 rounded-lg shadow-sm border-l-4 border-secondary">
                        <h4 class="font-bold text-secondary">üî• El √öltimo Cantar</h4>
                        <p class="text-sm">Verlo el primero es clave para evitar colas luego (Indoor).</p>
                    </div>
                </div>

                <!-- 12:00 Show 2 -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-24 text-right font-bold text-secondary mr-4">12:00</div>
                    <div class="w-4 h-4 bg-secondary rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-red-50 p-4 rounded-lg shadow-sm border-l-4 border-secondary">
                        <h4 class="font-bold text-secondary">üó°Ô∏è A Pluma y Espada</h4>
                        <p class="text-sm">El teatro del Siglo de Oro, perfecto antes de comer (Indoor).</p>
                    </div>
                </div>

                <!-- 13:30 Lunch (EARLIER) -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-24 text-right font-bold text-accent mr-4">13:30</div>
                    <div class="w-4 h-4 bg-accent rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-yellow-50 p-4 rounded-lg shadow-sm border-l-4 border-accent">
                        <h4 class="font-bold text-accent">ü•ò Comida Estrat√©gica</h4>
                        <p class="text-sm">Al abrir antes, comemos antes. Evitamos el caos de las 14:30.</p>
                    </div>
                </div>

                <!-- 15:00 Christmas Special -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-24 text-right font-bold text-primary mr-4">15:00</div>
                    <div class="w-4 h-4 bg-primary rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-green-100 p-4 rounded-lg shadow-sm border-l-4 border-primary ring-2 ring-accent">
                        <h4 class="font-bold text-primary">üëº Sue√±os de un √Ångel P√≠caro</h4>
                        <p class="text-sm"><strong>¬°Exclusivo Navidad!</strong> El show especial de temporada.</p>
                    </div>
                </div>

                <!-- 16:15 Show 3 -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-24 text-right font-bold text-secondary mr-4">16:15</div>
                    <div class="w-4 h-4 bg-secondary rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-red-50 p-4 rounded-lg shadow-sm border-l-4 border-secondary">
                        <h4 class="font-bold text-secondary">üåä Allende la Mar Oc√©ana</h4>
                        <p class="text-sm">Paseo inmersivo en el barco de Col√≥n (Indoor).</p>
                    </div>
                </div>

                <!-- 17:30 Show 4 -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-24 text-right font-bold text-secondary mr-4">17:30</div>
                    <div class="w-4 h-4 bg-secondary rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-red-50 p-4 rounded-lg shadow-sm border-l-4 border-secondary">
                        <h4 class="font-bold text-secondary">üê¥ El Misterio de Sorbaces</h4>
                        <p class="text-sm">√öltimo gran espect√°culo del d√≠a.</p>
                    </div>
                </div>

                <!-- 18:30 Walkthrough -->
                <div class="timeline-item flex items-center mb-8">
                    <div class="w-24 text-right font-bold text-primary mr-4">18:30</div>
                    <div class="w-4 h-4 bg-primary rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-green-100 p-4 rounded-lg shadow-sm border-l-4 border-primary">
                        <h4 class="font-bold text-primary">üêë El Gran Bel√©n Viviente</h4>
                        <p class="text-sm">Recorrido a pie. Imprescindible antes de irse.</p>
                    </div>
                </div>

                <!-- 19:00 Exit -->
                <div class="timeline-item flex items-center">
                    <div class="w-24 text-right font-bold text-gray-500 mr-4">19:00</div>
                    <div class="w-4 h-4 bg-gray-500 rounded-full border-4 border-white shadow"></div>
                    <div class="flex-1 ml-4 bg-gray-100 p-4 rounded-lg shadow-sm border-l-4 border-gray-500">
                        <h4 class="font-bold">Retirada</h4>
                        <p class="text-sm">Salida antes del cierre (y antes de la Cabalgata de Reyes a las 20:30h).</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="col-span-1 md:col-span-2 text-center py-8 text-gray-500 text-sm">
            <p>Generado para la Misi√≥n Puy du Fou - Especial Navidad 2025.</p>
        </div>

    </main>

    <script>
        // --- GEMINI API INTEGRATION ---
        
        async function askOracle(presetQuestion = null) {
            const apiKey = "AIzaSyAP3kCHvkkVUFTcbMfY9Xrn4t0DGFya_r0"; // Runtime Environment Key
            const inputField = document.getElementById('oracleInput');
            const introDiv = document.getElementById('oracleIntro');
            const responseDiv = document.getElementById('oracleResponse');
            const loadingDiv = document.getElementById('oracleLoading');
            
            const userQuestion = presetQuestion || inputField.value;

            if (!userQuestion) return;

            // UI State Updates
            introDiv.classList.add('hidden');
            responseDiv.classList.add('hidden');
            loadingDiv.classList.remove('hidden');
            if (presetQuestion) inputField.value = presetQuestion;

            // Context Prompt UPDATED FOR CHRISTMAS (10:00 Start)
            const systemContext = `
                Eres el "Or√°culo Navide√±o", un experto gu√≠a del parque Puy du Fou Espa√±a en Toledo durante la temporada de Navidad.
                Datos Actuales:
                - Fecha: S√°bado 6 de Diciembre de 2025 (Navidad).
                - Horario: 10:00h a 22:00h (pero el usuario se va a las 19:00h).
                - Clima: Fr√≠o y posible lluvia.
                - Espect√°culos ACTIVOS: El √öltimo Cantar, A Pluma y Espada, Allende la Mar Oc√©ana, Sorbaces, Sue√±os de un √Ångel P√≠caro (Especial Navidad), El Gran Bel√©n.
                - Espect√°culos CANCELADOS: Cetrer√≠a de Reyes, El Sue√±o de Toledo.
                
                Tu Misi√≥n:
                - Responde con esp√≠ritu navide√±o y medieval.
                - Usa emojis üéÑ‚ú®.
                - Recuerda que Cetrer√≠a NO est√° disponible.
            `;

            try {
                let response;
                let data;
                const maxRetries = 3;
                let delay = 1000;

                for (let i = 0; i < maxRetries; i++) {
                    response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: systemContext + "\n\nPregunta del viajero: " + userQuestion
                                }]
                            }]
                        })
                    });

                    data = await response.json();

                    if (!data.error) {
                        break;
                    }
                    if (i < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    } else {
                        throw new Error(data.error.message || 'Error desconocido.');
                    }
                }
                
                if (data.error) {
                    throw new Error(data.error.message || 'Error desconocido.');
                }

                const answer = data.candidates[0].content.parts[0].text;
                responseDiv.innerHTML = marked.parse(answer);
                loadingDiv.classList.add('hidden');
                responseDiv.classList.remove('hidden');

            } catch (error) {
                console.error('Error:', error);
                loadingDiv.classList.add('hidden');
                responseDiv.innerHTML = `<p class="text-red-600 font-bold">‚ò†Ô∏è El or√°culo est√° congelado. Int√©ntalo luego.</p>`;
                responseDiv.classList.remove('hidden');
            }
        }


        // --- CHART DATA PROCESSING (Updated colors for Christmas) ---

        function formatLabel(str, maxwidth) {
            var sections = [];
            var words = str.split(" ");
            var temp = "";
            words.forEach(function(item, index) {
                if (temp.length > 0) {
                    var concat = temp + ' ' + item;
                    if (concat.length > maxwidth) {
                        sections.push(temp);
                        temp = "";
                    } else {
                        if (index == (words.length - 1)) {
                            sections.push(concat);
                            return;
                        } else {
                            temp = concat;
                            return;
                        }
                    }
                }
                if (index == (words.length - 1)) {
                    sections.push(item);
                    return;
                }
                if (item.length < maxwidth) {
                    temp = item;
                } else {
                    sections.push(item);
                }
            });
            return sections;
        }

        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: '#165B33',
                    titleFont: { family: 'Cinzel', size: 14 },
                    callbacks: {
                         title: function(tooltipItems) {
                            const item = tooltipItems[0];
                            let label = item.chart.data.labels[item.dataIndex];
                            if (Array.isArray(label)) return label.join(' ');
                            return label;
                        }
                    }
                }
            }
        };

        const ctxWeather = document.getElementById('weatherChart').getContext('2d');
        const weatherChart = new Chart(ctxWeather, {
            type: 'bar',
            data: {
                labels: formatLabel('Temp M√≠nima, Temp M√°xima', 15),
                datasets: [{
                    label: '¬∞C',
                    data: [9, 15],
                    backgroundColor: ['#1B4F72', '#BB2528'], // Blue and Red
                    borderRadius: 8
                }]
            },
            options: {
                ...commonOptions,
                scales: {
                    y: { beginAtZero: true, max: 20 }
                }
            }
        });

    </script>
</body>
</html>
